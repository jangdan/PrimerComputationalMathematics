---
redirect_from:
  - "/maths/timestepping-an-ode"
interact_link: notebooks/maths/Timestepping_an_ODE.ipynb
kernel_name: python3
kernel_path: notebooks/maths
has_widgets: false
title: |-
  Timestepping an ODE
pagenum: 5
prev_page:
  url: /maths/TensorsReview.html
next_page:
  url: /coding/intro.html
suffix: .ipynb
search: y t delta yn f solution dot euler timestepping forward taylor series ode variable x where order example second step class span toc problem us frac tn n small mean scheme numerical odes only e form our function case method exact black next deriving derivative higher variables qquad dependent start exp rhs simple assume too div href data modified id item numnbspnbsp differential common respect independent always talk even problems appear newtons law solve thinking ddot well into system u lets left text nb notation need relatively assuming following true mathcal o terms very discrete solver note point line above

comment: "***PROGRAMMATICALLY GENERATED, DO NOT EDIT. SEE ORIGINAL FILES IN /notebooks***"
---

    <main class="jupyter-page">
    <div id="page-info"><div id="page-title">Timestepping an ODE</div>
</div>
    
<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><h1>Table of Contents<span class="tocSkip"></span></h1></p>
<div class="toc"><ul class="toc-item"><li><span><a href="#What-do-we-mean-by-timestepping?" data-toc-modified-id="What-do-we-mean-by-timestepping?-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>What do we mean by timestepping?</a></span></li><li><span><a href="#Deriving-the-forward-Euler-scheme-from-Taylor-series" data-toc-modified-id="Deriving-the-forward-Euler-scheme-from-Taylor-series-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>Deriving the forward Euler scheme from Taylor series</a></span></li></ul></div>
</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Solving-(or-&quot;timestepping&quot;)-an-ordinary-differential-equation-(ODE)">Solving (or "timestepping") an ordinary differential equation (ODE)<a class="anchor-link" href="#Solving-(or-&quot;timestepping&quot;)-an-ordinary-differential-equation-(ODE)"> </a></h1><h2 id="What-do-we-mean-by-timestepping?">What do we mean by timestepping?<a class="anchor-link" href="#What-do-we-mean-by-timestepping?"> </a></h2><p>The numerical solution of ODEs is a big topic.</p>
<p>A common type of ODE you will come across will only include a <em>first</em> derivative with respect to an independent variable.
This won't necessarily be time $t$ (it might be space $x$), but we can always "interpret" this indepedent as "time" or a time-like variable. This is why we commonly talk about "timestepping" an ODE even though there are lots of scenarios where
you will be doing this for problems either where $t$ doesn't appear, or isn't the variable the derivative has been taken with respect to!</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Aside: What would you do with a problem that includes higher than first order derivative. An example comes from Newton's second law, which tells us about acceleration (or rate of change of momentum), but we want to solve for position ($x$), i.e. we're thinking about an ODE in the form $\ddot{x}=f$.  Well we can always convert higher order problems into a <em>system</em> of ODEs only involving first order derivatives by introducing "dummy" variables. In the Newton's second law example just introduce velocity, then we can rewrite our second order problem $\ddot{x}=f$ as the coupled first order problem $\dot{x}=u,\;\dot{u}=f$.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's suppose we have an ODE of the form</p>
$$y' = f(t,y) \qquad\left[\text{NB. on the LHS we could also use the notation $\dot{y}$ or $\frac{dy}{dt}$}\right]
$$<p>This is describing a solution function of the form $y\equiv y(t)$, i.e. the solution $y$ is a function of one variable - $t$.</p>
<p>$y$ is called the <em>dependent variable</em> and $t$ the <em>dependent variable</em>.</p>
<p>[NB. in the case where $y$ is multi-dimensional - a vector of unknowns/dependent variables - we would talk about a <em>system of ODEs</em>. For the case where there are more than one independent variables then we need to start thinking about <em>partial differential equations (PDEs)</em>, covered later in this module and in ACSE-3].</p>
<p>For example</p>
$$y' = \exp(t), \qquad\text{or equivalently} \qquad y' = y$$<p>the first is an example where the RHS is a function of $t$ only, the second a function of $y$ only.</p>
<p>This is an example where both $t$ and $y$ appear on the RHS:</p>
$$y' = y + t^3$$<p>The first two ($y'=y$ or $y'=\exp(t)$) are relatively easy for us to solve analytically, the final case is a bit more challenging and we may need to resort to a numerical approach (or attempt symbolic computation).</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Deriving-the-forward-Euler-scheme-from-Taylor-series">Deriving the forward Euler scheme from Taylor series<a class="anchor-link" href="#Deriving-the-forward-Euler-scheme-from-Taylor-series"> </a></h2><p>There are several approached to motivate and develop numerical solvers for ODEs.</p>
<p>One common way is to make use of a Taylor series expansion.</p>
<p>From the notebook on Taylor series we know that (assuming smoothness of the solution) the following is true:</p>
$$ y(t+\Delta t) = y(t) + \Delta t \, y'(t) + \frac{\Delta t^2}{2!}y''(t) + \frac{\Delta t^3}{3!}y'''(t) + \mathcal{O}(\Delta t^4),$$<p>Using the notation $y_n=y(t_n), \; y'_n=y'(t_n)$ etc, and assuming a uniform time step size $\Delta t$, this is equivalent to</p>
$$ y_{n+1} = y_n + \Delta t\, y'_n + \frac{\Delta t^2}{2!}y''_n + \frac{\Delta t^3}{3!}y'''_n + \mathcal{O}(\Delta t^4).$$<p>Dropping second-order terms (which we can justify if $y$ is "smooth", which means that $y''$ is "well-behaved", and $\Delta t$ is chosen to be sufficiently small so that the terms containing higher powers of $\Delta t$ are relatively speaking <em>very small</em>),</p>
<p>and noting that $y'_n = f(t_n,y_n)$ we are left with the discrete relation</p>
$$y_{n+1} = y_n + \Delta t \, f(t_n,y_n).$$<p><br></p>
<p>This is a very famous ODE solver, or time-stepping method - termed the <strong>forward Euler</strong> or <strong>explicit Euler</strong> method.</p>
<p>We have turned the continuous problem into a discrete one - we have discretised. And note that this is in a form similar to our logistic map, so we know that we can write a simple piece of code that iterates over $n$ to evaluate/predict/approximate the dynamics.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's consider the simple model problem</p>
$$y' = y$$<p>with the initial condition</p>
$$y(0)=1$$<p>and see what one step of the forward Euler method does, we will assume that we start at some $t$ from the exact solution at that time, i.e. the starting point indicated by the red dot in the following image is on the exact solution (black) line.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;One step of Forward Euler&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># the RHS of the ODE</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="c1"># an example solution trajectory (or solution to ODE $\dot{y}=f(y), y(0)=1$)</span>
<span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trajectory $y=y(t)$&#39;</span><span class="p">)</span>

<span class="c1"># this is just some location in time</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mf">0.35</span>
<span class="c1"># and an example of a time step size large enough we can see what the method is doing</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)],</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">))],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$y&#39;=f(t_0,y_0)$&quot;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">)],</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact soln at $t_0 + \Delta t$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">))],</span> <span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FE numerical soln at $t_0 + \Delta t$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/maths/Timestepping_an_ODE_7_0.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The black dot in the figure above shows what the true/exact solution at the new $n$ level is, while the green dot shows what the numerical solver predicts it to be.</p>
<p>The difference between the two is the error that has been introduced in a single step of the method.</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now in the next step of the algorithm we of course have to start from the green dot as we assume in practice we don't know the black line.</p>
<p>The next step computes</p>
$$y_{n+1} = y_n + \Delta t \, f(t_n,y_n),$$<p>but note that $f$ for this particular simple test case is simply $y$.</p>
<p>We assume that we don't know what the exact solution is at this time level, and hence we can't read off the correct $t$ from the $x$ axis in the above plot and compute $\exp(t)$ in the RHS of our update. If we could then this would let us use the correct new slope at this time, i.e. the slope at the black dot.</p>
<p>Instead we are forced to read off the $y$ axis - notice that in this example this gives us a $y$ value that is too small, and hence an $f$ that is too small. Therefore our next update will give us a second point that is even more too small!</p>
<p>The moral of the story here is that <strong>errors generally accumulate</strong>, as we can see if we plot this next step of the algorithm:</p>

</div>
</div>
</div>
</div>

<div class="jb_cell">

<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Two steps of Forward Euler&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># the RHS of the ODE</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="c1"># an example solution trajectory (or solution to ODE $\dot{y}=f(y), y(0)=1$)</span>
<span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>


<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trajectory $y=y(t)$&#39;</span><span class="p">)</span>

<span class="c1"># this is just some location in time</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mf">0.35</span>
<span class="c1"># and an example of a time step size large enough we can see what the method is doing</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span>


<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)],</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">))],</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">t0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span> <span class="n">y1</span><span class="p">)],</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">dt</span><span class="p">)],</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">t0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)),</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span> <span class="n">y1</span><span class="p">)],</span> <span class="s1">&#39;go&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&lt;matplotlib.lines.Line2D at 0x2c93e4eeb38&gt;]</pre>
</div>

</div>
</div>
<div class="jb_output_wrapper }}">
<div class="output_area">



<div class="output_png output_subarea ">
<img src="../images/maths/Timestepping_an_ODE_10_1.png"
>
</div>

</div>
</div>
</div>
</div>

</div>
</div>

 


    </main>
    